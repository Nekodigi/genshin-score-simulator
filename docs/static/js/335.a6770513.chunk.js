(self.webpackChunktemp=self.webpackChunktemp||[]).push([[335],{4687:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return S}});var r=t(4165),a=t(5861),c=t(9439),i=t(1632),s=t(3967),u=t(4554),o=t(3863),f=t.n(o),l=t(2791),p=t(1362),v=t(8257),d=t(4893),h=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(n);case 2:return t=e.sent,e.abrupt("return",f().imread(t.target));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=function(e){return new Promise((function(n,t){var r=new Image;r.onload=function(e){return n(e)},r.onerror=function(e){return t(e)},r.src=e}))},x=function(e,n,t,r,a,c){var i=n.roi(new o.Rect(a.x,a.y,c.x-a.x,c.y-a.y));f().resize(i,i,new(f().Size)(i.size().width*t,i.size().height*t)),f().threshold(i,i,Math.abs(r),255,r>=0?f().THRESH_BINARY:f().THRESH_BINARY_INV),f().imshow(e.current,i)},m=t(4199),g=t(865),Z=t(6606),y=t(7419),k=function(e,n){var t=0,r="Adventurer",a="circlet";return"ja"===n&&(e=e.replace(/\s/g,"")),g.D.forEach((function(c){var i=Z[c];g.m.forEach((function(s){if(void 0!==i[s]){var u=(0,m.hY)(e,i[s].name[n]);u>t&&(r=c,a=s,t=u)}}))})),{key:r,slot:a,confidence:t}},z=function(e,n){var t=e.split("\n");t=t.filter((function(e){return""!==e}));for(var r=[],a=0;a<t.length;a++){var c=t[a];if(c.replace(/\s/g,"").includes("Set")||c.replace(/\s/g,"").includes("\u30bb\u30c3\u30c8"))break;r.push(c)}for(var i=0;i<4;i++)void 0===r[i]&&(r[i]="");return r.map((function(e){return b(e,n)}))},b=function(e,n){if(""===e)return{key:"",value:0,confidence:1};var t=e.split("+");if(1===t.length)for(var r=0;r<t[0].length;r++)if("\u24ea\u2460\u2461\u2462\u2463\u2464\u2465\u2466\u2467\u24680123456789".includes(t[0][r])){t[1]=t[0].substring(r),t[0]=t[0].substring(0,r);break}var a=t[0]+(e.includes("%")?"%":""),c=e.includes("%")?t[1].split("%")[0]:t[1],i=0,s="";a=a.replaceAll(" ","").replaceAll("\u30ab","\u529b"),[["\u24ea","0"],["\u2460","1"],["\u2461","2"],["\u2462","3"],["\u2463","4"],["\u2464","5"],["\u2465","6"],["\u2466","7"],["\u2467","8"],["\u2468","9"]].forEach((function(e){c=c.replaceAll(e[0],e[1])})),"en"===n?y.u.forEach((function(e){var t=(0,m.hY)(y.k[e].name[n],a);t>i&&(s=e,i=t)})):(e=e.replace(/\s/g,""),y.u.forEach((function(e){var t=(0,m.hY)(y.k[e].name[n],a);t>i&&(s=e,i=t)})));var u=Number(c);return y.u.forEach((function(t){var r=(0,m.hY)(y.k[t].name[n],e);r>i&&(s=t,i=r)})),{key:s,value:u,confidence:i}},R=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,t,a,c,i,s,u,o){var f,l,p,v,d,h,w;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(n,t,a,c,i,s,u,o);case 2:return f=e.sent,console.log(f),l=[],p=[],v=(0,m.Sh)(f.name.value.charAt(0))?"en":"ja",d={},h=k(f.name.value,v),d.setKey={key:h.key,confidence:h.confidence},d.slotKey={value:h.slot,confidence:h.confidence},h.confidence<.6&&(h.confidence>.4?l.push("set","slot"):p.push("set","slot")),d.rarity={value:f.star.value.replace(/\s/g,"").length,confidence:f.star.confidence},f.star.confidence<.5&&(f.star.confidence>.3?l.push("star"):p.push("star")),d.level={value:Number(f.level.value.replace(/^\D+/g,"")),confidence:f.level.confidence},f.level.confidence<.8&&(f.level.confidence>.5?l.push("level"):p.push("level")),w=b(f.mainKey.value+"+"+f.mainValue.value,v),d.mainstatKey={key:w.key,confidence:w.confidence},w.confidence<.6&&(w.confidence>.3?l.push("mainstat"):p.push("mainstat")),d.substats=z(f.substat.value,v),d.substats.forEach((function(e,n){e.confidence<.8&&(e.confidence>.5?l.push("substat".concat(n)):p.push("substat".concat(n)))})),d.warning=l,d.error=p,e.abrupt("return",d);case 24:case"end":return e.stop()}}),e)})));return function(n,t,r,a,c,i,s,u){return e.apply(this,arguments)}}(),P=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,t,i,s,u,o,l,v){var d,h,w,m,g,Z,y,k,z,b,R,P,L,E,S,_,D,C,M,j,A,K,T,I,N,O,U,F,Y,H,W,B,G,V,q,J,Q,$,X,ee,ne;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return performance.now(),v&&v(0),d=new(f().Mat),h=new(f().Mat),n.copyTo(d),w={},m=function(){var e=d.size().width/d.size().height;f().resize(d,h,new(f().Size)(360*e,360)),f().resize(d,d,new(f().Size)(720*t*e,720*t))},g=new(f().Mat),Z=new(f().Mat),y=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f().matchTemplate(h,s,g,f().TM_CCOEFF_NORMED,Z),n=f().minMaxLoc(g,Z),e.abrupt("return",n.maxLoc.x+s.cols);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f().matchTemplate(h,i,g,f().TM_CCOEFF_NORMED,Z),n=f().minMaxLoc(g,Z),e.abrupt("return",n.maxLoc.x);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m(),v&&v(10),e.next=15,Promise.all([y(),k()]);case 15:if(z=e.sent,b=(0,c.Z)(z,2),R=b[0],P=b[1],v&&v(30),L=new(f().Rect)(P*t*2,0,(R-P)*t*2,d.size().height),E=d.roi(L),S=E.size().width/E.size().height,f().resize(E,E,new(f().Size)(352*t,352*t/S)),f().matchTemplate(E,u,g,f().TM_CCOEFF,Z),_=f().minMaxLoc(g,Z),D=_.maxLoc,new(f().Point)(D.x+u.cols,D.y+u.rows),v&&v(40),C=D.y+u.rows/2,189,156,M=new(f().Rect)(12,C-189*t,328*t,345*t),j=E.roi(M),f().cvtColor(j,j,f().COLOR_BGR2GRAY),v&&v(50),A=new(f().Point)(17*t,2*t),K=new(f().Point)(312*t,36*t),T=new(f().Point)(16*t,46*t),I=new(f().Point)(146*t,64*t),N=new(f().Point)(16*t,100*t),O=new(f().Point)(146*t,118*t),U=new(f().Point)(16*t,118*t),F=new(f().Point)(118*t,150*t),Y=new(f().Point)(16*t,156*t),H=new(f().Point)(132*t,180*t),W=new(f().Point)(24*t,208*t),B=new(f().Point)(58*t,224*t),G=new(f().Point)(32*t,237*t),V=new(f().Point)(230*t,343*t),void 0!==l){e.next=58;break}return e.next=53,(0,p.createWorker)();case 53:return l=e.sent,e.next=56,l.loadLanguage("eng+jpn");case 56:return e.next=58,l.initialize("eng+jpn");case 58:return v&&v(60),q=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,.75,-180,A,K),e.next=3,l.setParameters({tessedit_char_whitelist:"Adventur's Flow\u5192\u967a\u8005\u306e\u82b1Taih\u7fbd\u6839PckW\u61d0\u4e2d\u6642\u8a08Gb\u91d1\u676fB\u30d0\u30f3\u30c0\u30cafC\u76e4\u77f3\u82bd\u751fJg\u5d6f\u5ce8\u9023\u5c71\u7ffcSE\u661f\u7f85\u572d\u7389\u65e5\u5371\u5ca9\u78d0M\u4e0d\u52d5\u7384\u76f8R\u72c2\u6226\u58eb\u8594\u8587Imp\u30b3\u30c3\u30d7\u4eee\u9762y\u5439\u96ea\u601d\u3044\u6c37\u3092\u7815\u304f\u57f7\u5ff5zHD\u8986\u3046\u6545\u90f7\u6700\u5f8c-\u971c\u7e8f\u3063\u305f\u6c17\u9aa8\u8e0f\u3080\u97f3\u8840\u67d3\u3081\u9244\u5fc3\u9ed2\u9a0e\u304c\u306b\u52c7\u52f2\u7ae0\u671f\u5f85\u6bc5\u7136O\u58ee\u884c\u51a0\u9b54\u5973\u708e\u7834\u6ec5\u7126\u3052\u5e3d\u5b50L\u8ff7\u5bae\u904a\u5ba2V\u7fe0\u8513\u77e5\u8ce2\u5b9a\u4eba\u706f\u6708\u6842\u5b9d\u5b88\u8b77\u5370\u7f6e\u304d\u74f6\u5e2fK\u8af8\u738b\u90fd\u59cb\u307e\u308a\u9ec4\u90a6\u56fd\u7d50\u672b\u6ca1\u843d\u9014\u30a2\u9154\u9577\u5922\u6d41\u7802\u55e3\u541b\u907a\u9b42\u9999\u5782\u8449\u796d\u7940\u8a3c\u6e67\u6c34\u6d6e\u5bfe\u5a01\u53b3\u9354\u5207\u96f7\u96f2\u7c60\u7dcb\u58fa\u83ef\u98fe\u515c\u5a18\u5f69\u8b1d\u5bb4\u5e2d\u51dd\u5239\u90a3\u79d8\u7d2b\u6676\u535a\u5f92\u30c4\u30dc\u30d4\u30b9\u5883\u88c1\u65adY\u6df1\u6b73\u7518\u9732\u7d42\u6295\u5f71N\u5263\u95d8\u672a\u7df4\u5e30\u7740\u5e0c\u671bx\u9169\u914a\u51f1\u65cb\u30e1\u30ad\u30b5\u30fc\u30b8\u30e5\u8ffd\u61b6\u98a8\u5805\u9285\u30d1\u6c88\u9152\u6f2c\u3051\u6804\u9928\u8846\u6b4c\u9192\u74e2\u7baa\u5f62\u9ab8\u7b20\u6559\u5b98\u30c6\u30a3\u30ab\u706b\u6e21\u5b9f\u89e3\u653e\u82e6\u3057\u307f\u609f\u6075\u5e78\u904b\u30af\u30ed\u9df9\u5f7c\u65b9\u3042\u308b\u5c11\u63fa\u3089\u3050\u77ed\u5e74\u66ab\u606f\u629c\u511a\u9854\u6b66\u8d64\u5668\u65e7\u8cb4\u65cfU\u9280q\u6d77\u6df5\u5225\u308c\u8c9d\u771f\u73e0\u7947\u7121\u57a2\u826f\u533b\u505c\u9813\u8d85\u8d8a\u76c3\u55e4\u7b11j\u9010\u5149\u7570\u96e2\u590f\u308f\u523b\u8239\u5b66\u304aQ\u30da\u30ec\u30ba\u7f88\u7d46\u77e2\u671d\u7948\u5e38\u5049\u662d\u8a93\u5c06\u5e25\u4ea1\u547d\u9ce5\u6190\u707d\u5b58\u9706\u524d\u5146\u547c\u3076\u8a0e\u3061\u5947\u8de1\u30cd\u30e2\u689f\u85ac\u5dfe\u970a\u6f5c\u967d\u8f61\u54c1\u5951\u7d04\u867a\u59ff\u91ce\u8a18\u8349\u539f\u72e9\u9752\u7dd1\u8272\u6c7a\u5bb9\u697d\u56e3\u7434\u5e2b\u30d5\u541f\u7b52\u6307\u63ee\u30cf\u30c8"});case 3:return e.next=5,l.recognize(o.current.toDataURL());case 5:return n=e.sent,e.next=8,l.setParameters({tessedit_char_whitelist:void 0});case 8:w.name={value:n.data.text,confidence:n.data.confidence};case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,1,-180,T,I),e.next=3,l.recognize(o.current.toDataURL());case 3:n=e.sent,w.slot={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,1,-135,N,O),e.next=3,l.recognize(o.current.toDataURL());case 3:n=e.sent,w.mainKey={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,.75,-180,U,F),e.next=3,l.recognize(o.current.toDataURL());case 3:n=e.sent,w.mainValue={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,1,-150,Y,H),e.next=3,l.recognize(o.current.toDataURL());case 3:n=e.sent,w.star={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ee=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,1,-150,W,B),e.next=3,l.setParameters({tessedit_char_whitelist:"+0123456789"});case 3:return e.next=5,l.recognize(o.current.toDataURL());case 5:return n=e.sent,e.next=8,l.setParameters({tessedit_char_whitelist:void 0});case 8:w.level={value:n.data.text,confidence:n.data.confidence};case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(o,j,1,140,G,V),e.next=3,l.recognize(o.current.toDataURL());case 3:n=e.sent,w.substat={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=68,q();case 68:return e.next=70,J();case 70:return e.next=72,Q();case 72:return e.next=74,$();case 74:return e.next=76,X();case 76:return e.next=78,ee();case 78:return e.next=80,ne();case 80:return v&&v(100),e.abrupt("return",w);case 82:case"end":return e.stop()}}),e)})));return function(n,t,r,a,c,i,s,u){return e.apply(this,arguments)}}(),L=t(9230),E=t(184),S=function(){var e=(0,l.useContext)(v.r).editor,n=(0,l.useRef)(null),t=(0,l.useState)(),o=(0,c.Z)(t,2),w=o[0],x=o[1],m=(0,l.useState)(),g=(0,c.Z)(m,2),Z=g[0],y=g[1],k=(0,l.useState)(""),z=(0,c.Z)(k,2),b=(z[0],z[1]),P=(0,L.$G)(["editor","common"]).t,S=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n,t,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("template/right.png");case 2:return n=e.sent,f().resize(n,n,new(f().Size)(n.size().width/2,n.size().height/2)),e.next=6,h("template/left.png");case 6:return t=e.sent,f().resize(t,t,new(f().Size)(t.size().width/2,t.size().height/2)),e.next=10,h("template/mid.png");case 10:return a=e.sent,f().resize(a,a,new(f().Size)(a.size().width/2,a.size().height/2)),x([n,t,a]),e.abrupt("return",[n,t,a]);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.createWorker)();case 2:return n=e.sent,e.next=5,n.loadLanguage("eng+jpn");case 5:return e.next=7,n.initialize("eng+jpn");case 7:y(n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){w||(_(),f().onRuntimeInitialized=(0,a.Z)((0,r.Z)().mark((function e(){var n,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:return n=e.sent,t=function(e){return M(e.clipboardData.files,n)},window.addEventListener("paste",t),e.abrupt("return",(function(){window.removeEventListener("paste",t)}));case 6:case"end":return e.stop()}}),e)}))))}),[]);var D=(0,s.Z)(),C=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(n.target.files),null!==n.target.files&&0!==n.target.files.length&&void 0!==w){e.next=3;break}return e.abrupt("return");case 3:j(n.target.files[0],w),n.target.files=null;case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),M=function(e,n){null!==e&&void 0!==n&&j(e[0],n)},j=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(a,c){var i,s,u,o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==Z){t.next=3;break}return t.next=3,S();case 3:return e.setInfo({sevarity:"info",text:P("common:info.loadStart")}),i=URL.createObjectURL(a),b(i),t.next=8,h(i);case 8:return s=t.sent,t.prev=9,t.next=12,R(s,1.5,c[1],c[0],c[2],n,Z);case 12:u=t.sent,console.log(u),console.log(u.warning,u.error),o={setKey:(r=u).setKey.key,rarity:r.rarity.value,level:r.level.value,slotKey:r.slotKey.value,mainstatKey:r.mainstatKey.key,substats:r.substats.map((function(e){return{key:e.key,value:e.value}}))},e.setArtifact(o),console.log(o),0===u.warning.length&&0===u.error.length?e.setInfo({sevarity:"success",text:P("common:info.loadSuccess")}):e.setInfo({sevarity:"warning",text:P("common:info.loadWarning")}),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(9),console.log("CANNOT READ",t.t0),e.setInfo({sevarity:"error",text:P("common:info.loadFailed")});case 25:case"end":return t.stop()}var r}),t,null,[[9,21]])})));return function(e,n){return t.apply(this,arguments)}}();return(0,E.jsx)(u.Z,{display:"flex",flexDirection:"column",gap:1,children:(0,E.jsxs)(d.W,{text:P("editor.uploadScreenShot"),icon:i._jT,color:D.palette.info.dark,children:[(0,E.jsx)("input",{onChange:C,type:"file",accept:"image/*",hidden:!0}),(0,E.jsx)("canvas",{ref:n,style:{display:"none"}})]})})}},4619:function(){},3004:function(){},7897:function(){}}]);
//# sourceMappingURL=335.a6770513.chunk.js.map