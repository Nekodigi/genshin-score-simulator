(self.webpackChunktemp=self.webpackChunktemp||[]).push([[180],{2283:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return L}});var r=t(4165),a=t(5861),c=t(9439),i=t(1632),s=t(3967),o=t(4554),u=t(3239),f=t(3863),l=t.n(f),p=t(2791),d=t(1362),v=t(8257),h=t(4893),w=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(n);case 2:return t=e.sent,e.abrupt("return",l().imread(t.target));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),x=function(e){return new Promise((function(n,t){var r=new Image;r.onload=function(e){return n(e)},r.onerror=function(e){return t(e)},r.src=e}))},m=function(e,n,t,r,a,c){var i=n.roi(new f.Rect(a.x,a.y,c.x-a.x,c.y-a.y));l().resize(i,i,new(l().Size)(i.size().width*t,i.size().height*t)),l().threshold(i,i,Math.abs(r),255,r>=0?l().THRESH_BINARY:l().THRESH_BINARY_INV),l().imshow(e.current,i)},Z=t(4199),g=t(6318),y=t(9541),z=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,t,a,c,i,s,o,u){var f,l,p,d,v,h,w;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(n,t,a,c,i,s,o,u);case 2:return f=e.sent,console.log(f),l=[],p=[],d=(0,Z.Sh)(f.slot.value.charAt(0))?"en":"ja",v={},h=(0,g.oV)(f.name.value,d),v.setKey={key:h.key,confidence:h.confidence},v.slotKey={value:h.slot,confidence:h.confidence},h.confidence<.6&&(h.confidence>.4?l.push("set","slot"):p.push("set","slot")),v.rarity={value:Math.max(Math.min(f.star.value.replace(/\s/g,"").length,5),1),confidence:f.star.confidence},f.star.confidence<.5&&(f.star.confidence>.3?l.push("star"):p.push("star")),v.level={value:Number(f.level.value.replace(/^\D+/g,"")),confidence:f.level.confidence},f.level.confidence<.8&&(f.level.confidence>.5?l.push("level"):p.push("level")),w=(0,g.OY)(f.mainKey.value+"+"+f.mainValue.value,d),v.mainStatKey={key:w.key,confidence:w.confidence},w.confidence<.6&&(w.confidence>.3?l.push("mainstat"):p.push("mainstat")),v.substats=(0,g.$D)(f.substat.value,d),v.substats.forEach((function(e,n){e.confidence<.7&&(e.confidence>.5?l.push("substat".concat(n)):p.push("substat".concat(n)))})),v.warning=l,v.error=p,e.abrupt("return",v);case 24:case"end":return e.stop()}}),e)})));return function(n,t,r,a,c,i,s,o){return e.apply(this,arguments)}}(),k=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,t,i,s,o,u,f,p){var v,h,w,x,Z,g,z,k,b,R,L,S,P,M,D,_,C,j,E,K,T,O,I,U,N,A,F,G,H,V,W,Y,B,$,q,J,Q,X,ee,ne,te;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return performance.now(),p&&p(0),v=new(l().Mat),h=new(l().Mat),n.copyTo(v),w={},x=function(){var e=v.size().width/v.size().height;l().resize(v,h,new(l().Size)(360*e,360)),l().resize(v,v,new(l().Size)(720*t*e,720*t))},Z=new(l().Mat),g=new(l().Mat),z=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l().matchTemplate(h,s,Z,l().TM_CCOEFF_NORMED,g),n=l().minMaxLoc(Z,g),e.abrupt("return",n.maxLoc.x+s.cols);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l().matchTemplate(h,i,Z,l().TM_CCOEFF_NORMED,g),n=l().minMaxLoc(Z,g),e.abrupt("return",n.maxLoc.x);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x(),p&&p(10),e.next=15,Promise.all([z(),k()]);case 15:if(b=e.sent,R=(0,c.Z)(b,2),L=R[0],S=R[1],p&&p(30),P=new(l().Rect)(S*t*2,0,(L-S)*t*2,v.size().height),M=v.roi(P),D=M.size().width/M.size().height,l().resize(M,M,new(l().Size)(352*t,352*t/D)),l().matchTemplate(M,o,Z,l().TM_CCOEFF,g),_=l().minMaxLoc(Z,g),C=_.maxLoc,new(l().Point)(C.x+o.cols,C.y+o.rows),p&&p(40),j=C.y+o.rows/2,189,156,E=new(l().Rect)(12,j-189*t,328*t,345*t),K=M.roi(E),l().cvtColor(K,K,l().COLOR_BGR2GRAY),p&&p(50),T=new(l().Point)(17*t,2*t),O=new(l().Point)(312*t,30*t),I=new(l().Point)(16*t,46*t),U=new(l().Point)(146*t,64*t),N=new(l().Point)(16*t,100*t),A=new(l().Point)(146*t,118*t),F=new(l().Point)(16*t,118*t),G=new(l().Point)(118*t,150*t),H=new(l().Point)(16*t,156*t),V=new(l().Point)(132*t,180*t),W=new(l().Point)(24*t,208*t),Y=new(l().Point)(58*t,224*t),B=new(l().Point)(32*t,237*t),$=new(l().Point)(230*t,343*t),void 0!==f){e.next=58;break}return e.next=53,(0,d.createWorker)();case 53:return f=e.sent,e.next=56,f.loadLanguage("eng+jpn");case 56:return e.next=58,f.initialize("eng+jpn");case 58:return p&&p(60),q=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,.75,-180,T,O),(0,y.G)(u),e.next=4,f.recognize(u.current.toDataURL());case 4:n=e.sent,w.name={value:n.data.text,confidence:n.data.confidence};case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,1,-180,I,U),e.next=3,f.recognize(u.current.toDataURL());case 3:n=e.sent,w.slot={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,1,-135,N,A),(0,y.G)(u),e.next=4,f.recognize(u.current.toDataURL());case 4:n=e.sent,w.mainKey={value:n.data.text,confidence:n.data.confidence};case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,.75,-180,F,G),e.next=3,f.recognize(u.current.toDataURL());case 3:n=e.sent,w.mainValue={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ee=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,1,-150,H,V),e.next=3,f.recognize(u.current.toDataURL());case 3:n=e.sent,w.star={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,1,-150,W,Y),e.next=3,f.setParameters({tessedit_char_whitelist:"+0123456789"});case 3:return e.next=5,f.recognize(u.current.toDataURL());case 5:return n=e.sent,e.next=8,f.setParameters({tessedit_char_whitelist:void 0});case 8:w.level={value:n.data.text,confidence:n.data.confidence};case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(u,K,1,140,B,$),e.next=3,f.recognize(u.current.toDataURL());case 3:n=e.sent,w.substat={value:n.data.text,confidence:n.data.confidence};case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=68,q();case 68:return e.next=70,J();case 70:return e.next=72,Q();case 72:return e.next=74,X();case 74:return e.next=76,ee();case 76:return e.next=78,ne();case 78:return e.next=80,te();case 80:return p&&p(100),e.abrupt("return",w);case 82:case"end":return e.stop()}}),e)})));return function(n,t,r,a,c,i,s,o){return e.apply(this,arguments)}}(),b=t(9230),R=t(184),L=function(){var e=(0,p.useContext)(v.r).editor,n=(0,p.useRef)(null),t=(0,p.useState)(),f=(0,c.Z)(t,2),x=f[0],m=f[1],Z=(0,p.useState)(),g=(0,c.Z)(Z,2),y=g[0],k=g[1],L=(0,p.useState)(""),S=(0,c.Z)(L,2),P=(S[0],S[1]),M=(0,b.$G)(["editor","common"]).t,D=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n,t,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w("template/right.png");case 2:return n=e.sent,l().resize(n,n,new(l().Size)(n.size().width/2,n.size().height/2)),e.next=6,w("template/left.png");case 6:return t=e.sent,l().resize(t,t,new(l().Size)(t.size().width/2,t.size().height/2)),e.next=10,w("template/mid.png");case 10:return a=e.sent,l().resize(a,a,new(l().Size)(a.size().width/2,a.size().height/2)),m([n,t,a]),e.abrupt("return",[n,t,a]);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.createWorker)();case 2:return n=e.sent,e.next=5,n.loadLanguage("eng+jpn");case 5:return e.next=7,n.initialize("eng+jpn");case 7:k(n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,p.useEffect)((function(){x||(_(),l().onRuntimeInitialized=(0,a.Z)((0,r.Z)().mark((function e(){var n,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:return n=e.sent,t=function(e){return E(e.clipboardData.files,n)},window.addEventListener("paste",t),e.abrupt("return",(function(){window.removeEventListener("paste",t)}));case 6:case"end":return e.stop()}}),e)}))))}),[]);var C=(0,s.Z)(),j=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(n.target.files),null!==n.target.files&&0!==n.target.files.length&&void 0!==x){e.next=3;break}return e.abrupt("return");case 3:K(n.target.files[0],x),n.target.files=null;case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),E=function(e,n){null!==e&&void 0!==n&&K(e[0],n)},K=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(a,c){var i,s,o,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==y){t.next=3;break}return t.next=3,D();case 3:return e.setInfo({sevarity:"info",text:M("common:info.loadStart")}),i=URL.createObjectURL(a),P(i),t.next=8,w(i);case 8:return s=t.sent,t.prev=9,t.next=12,z(s,1.5,c[1],c[0],c[2],n,y);case 12:o=t.sent,console.log(o),console.log(o.warning,o.error),u={setKey:(r=o).setKey.key,rarity:r.rarity.value,level:r.level.value,slotKey:r.slotKey.value,mainStatKey:r.mainStatKey.key,substats:r.substats.map((function(e){return{key:e.key,value:e.value}}))},e.setArtifact(u),console.log(u),0===o.warning.length&&0===o.error.length?e.setInfo({sevarity:"success",text:M("common:info.loadSuccess")}):e.setInfo({sevarity:"warning",text:M("common:info.loadWarning")}),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(9),console.log("CANNOT READ",t.t0),e.setInfo({sevarity:"error",text:M("common:info.loadFailed")});case 25:case"end":return t.stop()}var r}),t,null,[[9,21]])})));return function(e,n){return t.apply(this,arguments)}}();return(0,R.jsx)(o.Z,{display:"flex",flexDirection:"column",gap:1,children:void 0!==y&&void 0!==x?(0,R.jsxs)(h.W,{text:M("editor.uploadScreenShot"),icon:i._jT,color:C.palette.info.dark,children:[(0,R.jsx)("input",{onChange:j,type:"file",accept:"image/*",hidden:!0}),(0,R.jsx)("canvas",{ref:n,style:{display:"none"}})]}):(0,R.jsx)(u.Z,{})})}},4619:function(){},3004:function(){},7897:function(){}}]);
//# sourceMappingURL=180.b1a5a1cd.chunk.js.map