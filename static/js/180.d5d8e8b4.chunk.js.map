{"version":3,"file":"static/js/180.d5d8e8b4.chunk.js","mappings":"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","sources":["utils/func/opencv.ts","utils/func/artifactScan.ts","components/molecules/AutoFillButton.tsx"],"sourcesContent":["import cv, { Mat, Point, Rect } from \"@techstark/opencv-js\";\n\nexport const imreadUrl = async (url: string): Promise<Mat> => {\n  let e = await loadImage(url);\n  //console.log(e.target);\n  return cv.imread(e.target as HTMLElement);\n};\n\nexport const loadImage = (src: string): Promise<Event> => {\n  return new Promise((resolve, reject) => {\n    const i = new Image();\n    i.onload = (e) => resolve(e);\n    i.onerror = (e) => reject(e);\n    i.src = src;\n  });\n};\n\nexport const imshowTrimmed = (\n  ref: React.RefObject<HTMLCanvasElement>,\n  src: Mat,\n  scale: number,\n  threshold: number,\n  p1: Point,\n  p2: Point\n) => {\n  let i = src.roi(new Rect(p1.x, p1.y, p2.x - p1.x, p2.y - p1.y));\n  cv.resize(i, i, new cv.Size(i.size().width * scale, i.size().height * scale));\n  cv.threshold(\n    i,\n    i,\n    Math.abs(threshold),\n    255,\n    threshold >= 0 ? cv.THRESH_BINARY : cv.THRESH_BINARY_INV\n  );\n  cv.imshow(ref.current!, i);\n};\n","import cv, { MinMaxLoc, Rect } from \"@techstark/opencv-js\";\nimport Tesseract, { createWorker } from \"tesseract.js\";\nimport { setKeyType, slotKeyType } from \"../consts/Artifact\";\nimport { statKeyType } from \"../consts/Stat\";\nimport { ArtifactType } from \"../types/Artifact\";\nimport { Language } from \"../types/Language\";\nimport { SubstatType } from \"../types/Substat\";\nimport { imshowTrimmed } from \"./opencv\";\nimport { isAlphabet } from \"./string\";\nimport { str2artifactSet, str2stat, str2stats } from \"./strToArtifact\";\nimport setChars from \"../consts/set-charlist.json\";\nimport { downloadImage } from \"./download\";\n\n//PROCESSED\nexport type ArtifactScanOut = {\n  setKey: ScanResSetKey;\n  rarity: ScanResNum;\n  level: ScanResNum;\n  slotKey: ScanResSlotKey;\n  mainStatKey: ScanResStatKey;\n  substats: ScanResStat[];\n  warning: string[];\n  error: string[];\n};\n\n//scale change sample size: larger precise, smaller faster\nexport type ArtifactScanStrOut = {\n  name: ScanRes;\n  slot: ScanRes;\n  mainKey: ScanRes;\n  mainValue: ScanRes;\n  star: ScanRes;\n  level: ScanRes;\n  substat: ScanRes;\n};\n\nexport const ScanRes2GOOD = (scanned: ArtifactScanOut): ArtifactType => {\n  return {\n    setKey: scanned.setKey.key,\n    rarity: scanned.rarity.value as 1 | 2 | 3 | 4 | 5,\n    level: scanned.level.value,\n    slotKey: scanned.slotKey.value,\n    mainStatKey: scanned.mainStatKey.key,\n    substats: scanned.substats.map((substat) => {\n      return { key: substat.key, value: substat.value } as SubstatType;\n    }),\n  };\n};\n\nexport const ArtifactScan = async (\n  src: cv.Mat,\n  scale: number,\n  left: cv.Mat,\n  right: cv.Mat,\n  mid: cv.Mat,\n  buf: React.RefObject<HTMLCanvasElement>,\n  worker?: Tesseract.Worker,\n  setProgress?: (value: number) => void\n) => {\n  let strs = await ArtifactScanStr(\n    src,\n    scale,\n    left,\n    right,\n    mid,\n    buf,\n    worker,\n    setProgress\n  );\n\n  console.log(strs);\n\n  let warning: string[] = [];\n  let error: string[] = [];\n\n  let lang: Language = isAlphabet(strs.slot.value.charAt(0)) ? \"en\" : \"ja\";\n  let res = {} as ArtifactScanOut;\n  let set = str2artifactSet(strs.name.value, lang);\n  res.setKey = { key: set.key, confidence: set.confidence };\n  res.slotKey = { value: set.slot, confidence: set.confidence };\n  if (set.confidence < 0.6)\n    set.confidence > 0.4\n      ? warning.push(\"set\", \"slot\")\n      : error.push(\"set\", \"slot\");\n  res.rarity = {\n    value: Math.max(Math.min(strs.star.value.replace(/\\s/g, \"\").length, 5), 1),\n    confidence: strs.star.confidence,\n  };\n  if (strs.star.confidence < 0.5)\n    strs.star.confidence > 0.3 ? warning.push(\"star\") : error.push(\"star\");\n  //could compare with main stat and improve accuracy\n  res.level = {\n    value: Number(strs.level.value.replace(/^\\D+/g, \"\")),\n    confidence: strs.level.confidence,\n  };\n  if (strs.level.confidence < 0.8)\n    strs.level.confidence > 0.5 ? warning.push(\"level\") : error.push(\"level\");\n  let mainstat = str2stat(\n    strs.mainKey.value + \"+\" + strs.mainValue.value,\n    lang\n  );\n  res.mainStatKey = { key: mainstat.key, confidence: mainstat.confidence };\n  if (mainstat.confidence < 0.6)\n    mainstat.confidence > 0.3\n      ? warning.push(\"mainstat\")\n      : error.push(\"mainstat\");\n\n  res.substats = str2stats(strs.substat.value, lang);\n  res.substats.forEach((stat, i) => {\n    if (stat.confidence < 0.7)\n      stat.confidence > 0.5\n        ? warning.push(`substat${i}`)\n        : error.push(`substat${i}`);\n  });\n  res.warning = warning;\n  res.error = error;\n\n  return res;\n};\n\nexport const ArtifactScanStr = async (\n  src_: cv.Mat,\n  scale: number,\n  left: cv.Mat,\n  right: cv.Mat,\n  mid: cv.Mat,\n  buf: React.RefObject<HTMLCanvasElement>,\n  worker?: Tesseract.Worker,\n  setProgress?: (value: number) => void\n) => {\n  let time = performance.now();\n  setProgress && setProgress(0);\n  let src = new cv.Mat();\n  let small = new cv.Mat();\n  src_.copyTo(src);\n\n  let res = {} as ArtifactScanStrOut;\n\n  const resize = () => {\n    let aspect = src.size().width / src.size().height;\n    cv.resize(src, small, new cv.Size((720 / 2) * aspect, 720 / 2)); //* RESIZE FOR FASTER RES,\n    cv.resize(src, src, new cv.Size(720 * scale * aspect, 720 * scale)); //* RESIZE FOR FASTER RES,\n  };\n\n  let dst = new cv.Mat();\n  let mask = new cv.Mat();\n\n  const rightMatch = async () => {\n    cv.matchTemplate(small, right, dst, cv.TM_CCOEFF_NORMED, mask);\n    let result = cv.minMaxLoc(dst, mask) as any as MinMaxLoc;\n    return result.maxLoc.x + right.cols;\n  };\n  const leftMatch = async () => {\n    cv.matchTemplate(small, left, dst, cv.TM_CCOEFF_NORMED, mask);\n    let result = cv.minMaxLoc(dst, mask) as any as MinMaxLoc;\n    return result.maxLoc.x;\n  };\n\n  resize();\n  setProgress && setProgress(10);\n  // console.log(performance.now() - time, src.size());\n  // time = performance.now();\n\n  const [rightright, leftleft] = await Promise.all([rightMatch(), leftMatch()]);\n  setProgress && setProgress(30);\n  // console.log(performance.now() - time, \"left right match\");\n  // time = performance.now();\n\n  let slimRect = new cv.Rect(\n    leftleft * scale * 2,\n    0,\n    (rightright - leftleft) * scale * 2,\n    src.size().height\n  );\n  let slimImg = src.roi(slimRect);\n  //*RESIZE AFTER CLOP!!!!!!!!!\n  let aspect = slimImg.size().width / slimImg.size().height;\n\n  cv.resize(slimImg, slimImg, new cv.Size(352 * scale, (352 * scale) / aspect));\n\n  cv.matchTemplate(slimImg, mid, dst, cv.TM_CCOEFF, mask);\n  let result = cv.minMaxLoc(dst, mask) as any as MinMaxLoc;\n  let maxPoint = result.maxLoc;\n  let point = new cv.Point(maxPoint.x + mid.cols, maxPoint.y + mid.rows);\n  setProgress && setProgress(40);\n  // console.log(performance.now() - time, \"slimmed\");\n  // time = performance.now();\n\n  let midSeparator = maxPoint.y + mid.rows / 2;\n  let topHalfHeight = 189;\n  let topHalfBottom = 156;\n  let topHalfR = new cv.Rect(\n    12,\n    midSeparator - topHalfHeight * scale,\n    328 * scale,\n    (topHalfHeight + topHalfBottom) * scale\n  );\n  let trimmedImg = slimImg.roi(topHalfR);\n  cv.cvtColor(trimmedImg, trimmedImg, cv.COLOR_BGR2GRAY);\n  setProgress && setProgress(50);\n  // console.log(performance.now() - time, \"trimmed\");\n  // time = performance.now();\n\n  let name1p = new cv.Point(17 * scale, 2 * scale);\n  let name2p = new cv.Point((17 + 295) * scale, (2 + 28) * scale);\n  let part1p = new cv.Point(16 * scale, 46 * scale);\n  let part2p = new cv.Point((16 + 130) * scale, (46 + 18) * scale);\n  let mainKey1p = new cv.Point(16 * scale, 100 * scale);\n  let mainKey2p = new cv.Point((16 + 130) * scale, (100 + 18) * scale);\n  let mainValue1p = new cv.Point(16 * scale, 118 * scale);\n  let mainValue2p = new cv.Point((16 + 102) * scale, (118 + 32) * scale);\n  let star1p = new cv.Point(16 * scale, 156 * scale);\n  let star2p = new cv.Point((16 + 116) * scale, (156 + 24) * scale);\n  let level1p = new cv.Point(24 * scale, 208 * scale);\n  let level2p = new cv.Point((24 + 34) * scale, (208 + 16) * scale);\n  let substat1p = new cv.Point(32 * scale, 237 * scale);\n  let substat2p = new cv.Point((32 + 198) * scale, (237 + 106) * scale);\n\n  if (worker === undefined) {\n    worker = await createWorker(); //{logger: (m) => console.log(m), // Add logger here}\n    await worker.loadLanguage(\"eng+jpn\");\n    await worker.initialize(\"eng+jpn\");\n  }\n  setProgress && setProgress(60);\n  // console.log(performance.now() - time, \"worker initialized\");\n  // time = performance.now();\n\n  const fname = async () => {\n    imshowTrimmed(buf, trimmedImg, 0.75, -180, name1p, name2p);\n    //downloadImage(buf);\n    //console.log(setChars.replace(/[A-z]/g, \"\"));\n    // await worker!.setParameters({\n    //   tessedit_char_whitelist: setChars.replace(/[A-z]/g, \"\"),\n    // });\n    let result = await worker!.recognize(buf.current!.toDataURL()); //, \"jpn\"\n    // await worker!.setParameters({\n    //   tessedit_char_whitelist: undefined,\n    // });\n    res.name = { value: result.data.text, confidence: result.data.confidence };\n  };\n\n  const fslot = async () => {\n    imshowTrimmed(buf, trimmedImg, 1, -180, part1p, part2p);\n    let result = await worker!.recognize(buf.current!.toDataURL()); //, \"jpn\"\n    res.slot = { value: result.data.text, confidence: result.data.confidence };\n  };\n\n  const fmainKey = async () => {\n    imshowTrimmed(buf, trimmedImg, 1, -135, mainKey1p, mainKey2p);\n    //downloadImage(buf);\n    let result = await worker!.recognize(buf.current!.toDataURL()); //, \"jpn\" //nograyscale\n    res.mainKey = {\n      value: result.data.text,\n      confidence: result.data.confidence,\n    };\n  };\n  const fmainValue = async () => {\n    imshowTrimmed(buf, trimmedImg, 0.75, -180, mainValue1p, mainValue2p);\n    let result = await worker!.recognize(buf.current!.toDataURL());\n    res.mainValue = {\n      value: result.data.text,\n      confidence: result.data.confidence,\n    };\n  };\n\n  const fstar = async () => {\n    imshowTrimmed(buf, trimmedImg, 1, -150, star1p, star2p);\n    let result = await worker!.recognize(buf.current!.toDataURL()); //, \"chi_tra\"\n    res.star = { value: result.data.text, confidence: result.data.confidence };\n  };\n\n  const flevel = async () => {\n    imshowTrimmed(buf, trimmedImg, 1, -150, level1p, level2p);\n    await worker!.setParameters({\n      tessedit_char_whitelist: \"+0123456789\",\n    });\n    let result = await worker!.recognize(buf.current!.toDataURL()); //nograyscale\n    await worker!.setParameters({\n      tessedit_char_whitelist: undefined,\n    });\n    res.level = { value: result.data.text, confidence: result.data.confidence };\n  };\n\n  const fsubstat = async () => {\n    imshowTrimmed(buf, trimmedImg, 1, 140, substat1p, substat2p);\n    let result = await worker!.recognize(buf.current!.toDataURL()); //, \"jpn\"\n    res.substat = {\n      value: result.data.text,\n      confidence: result.data.confidence,\n    };\n  };\n\n  // setProgress && setProgress(70);\n  //console.log(performance.now() - time, \"Start tesseract\");\n  // time = performance.now();\n  await fname();\n  await fslot();\n  await fmainKey();\n  await fmainValue();\n  await fstar();\n  await flevel();\n  await fsubstat();\n\n  //await worker.terminate();\n  setProgress && setProgress(100);\n  // console.log(performance.now() - time, \"end tesseract\");\n  // time = performance.now();\n  return res;\n};\n\nexport type ScanRes = {\n  value: string;\n  confidence: number;\n};\n\nexport type ScanResSlotKey = {\n  value: slotKeyType;\n  confidence: number;\n};\nexport type ScanResNum = {\n  value: number;\n  confidence: number;\n};\n\nexport type ScanResSetKey = {\n  key: setKeyType;\n  confidence: number;\n};\n\nexport type ScanResStat = {\n  key: statKeyType;\n  value: number;\n  confidence: number;\n};\n\nexport type ScanResStatKey = {\n  key: statKeyType;\n  confidence: number;\n};\n","import { faCamera } from \"@fortawesome/free-solid-svg-icons\";\nimport { Box, CircularProgress, LinearProgress, useTheme } from \"@mui/material\";\nimport cv, { Mat } from \"@techstark/opencv-js\";\nimport { useContext, useEffect, useCallback } from \"react\";\nimport Tesseract, { createWorker } from \"tesseract.js\";\nimport { Artifact } from \"../../utils/class/Artifact\";\nimport { EditorContext } from \"../../utils/contexts/EditorContext\";\nimport { IconTextButton } from \"./IconTextButton\";\nimport { useRef, useState } from \"react\";\nimport { imreadUrl } from \"../../utils/func/opencv\";\nimport { ArtifactScan, ScanRes2GOOD } from \"../../utils/func/artifactScan\";\nimport { useTranslation } from \"react-i18next\";\n\nconst AutoFillButton = () => {\n  let { editor } = useContext(EditorContext);\n  const dummyImgRef = useRef<HTMLCanvasElement>(null);\n  const [templateImgs, setTemplateImgs] = useState<Mat[] | undefined>();\n  const [worker, setWorker] = useState<Tesseract.Worker>();\n  const [imgSrc, setImgSrc] = useState(\"\");\n  const { t } = useTranslation([\"editor\", \"common\"]);\n\n  let scale = 1.5; //small faster large precise\n\n  const loadTemplate = async () => {\n    let i1 = await imreadUrl(\"template/right.png\");\n    cv.resize(i1, i1, new cv.Size(i1.size().width / 2, i1.size().height / 2));\n    let i2 = await imreadUrl(\"template/left.png\");\n    cv.resize(i2, i2, new cv.Size(i2.size().width / 2, i2.size().height / 2));\n    let i3 = await imreadUrl(\"template/mid.png\");\n    cv.resize(i3, i3, new cv.Size(i3.size().width / 2, i3.size().height / 2));\n    setTemplateImgs([i1, i2, i3]);\n    //console.log(\"SET IMAGE\");\n    return [i1, i2, i3];\n  };\n\n  const initWorker = async () => {\n    let worker = await createWorker(); //{logger: (m) => console.log(m), // Add logger here}\n    await worker.loadLanguage(\"eng+jpn\");\n    await worker.initialize(\"eng+jpn\");\n    setWorker(worker);\n  };\n\n  useEffect(() => {\n    if (templateImgs) return;\n    initWorker();\n    cv[\"onRuntimeInitialized\"] = async () => {\n      let templateImgs_ = await loadTemplate();\n      const pasteFunc = (e) => pasteImage(e.clipboardData.files, templateImgs_);\n      window.addEventListener(\"paste\", pasteFunc);\n      return () => {\n        window.removeEventListener(\"paste\", pasteFunc);\n      };\n    };\n  }, []);\n\n  const theme = useTheme();\n\n  const uploadImage = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    console.log(e.target.files);\n    if (\n      e.target.files === null ||\n      e.target.files.length === 0 ||\n      templateImgs === undefined\n    )\n      return;\n    setArtifactFromImage(e.target.files[0], templateImgs as Mat[]);\n    e.target.files = null;\n  };\n\n  const pasteImage = (files: Blob, templateImgs: Mat[]) => {\n    if (files === null || templateImgs === undefined) return;\n    setArtifactFromImage(files[0], templateImgs);\n  };\n\n  const setArtifactFromImage = async (file: Blob, templateImgs: Mat[]) => {\n    if (worker === undefined) await loadTemplate();\n    editor.setInfo({ sevarity: \"info\", text: t(\"common:info.loadStart\") });\n    let url = URL.createObjectURL(file);\n    setImgSrc(url);\n    //try {\n    //let path = URL.createObjectURL(file);\n    let i = await imreadUrl(url);\n    try {\n      let res = await ArtifactScan(\n        i,\n        scale,\n        templateImgs[1],\n        templateImgs[0],\n        templateImgs[2],\n        dummyImgRef,\n        worker\n      );\n      console.log(res);\n      console.log(res.warning, res.error);\n      let good = ScanRes2GOOD(res);\n      editor.setArtifact(good);\n      console.log(good);\n      if (res.warning.length === 0 && res.error.length === 0) {\n        editor.setInfo({\n          sevarity: \"success\",\n          text: t(\"common:info.loadSuccess\"),\n        });\n      } else {\n        editor.setInfo({\n          sevarity: \"warning\",\n          text: t(\"common:info.loadWarning\"),\n        });\n      }\n    } catch (e) {\n      console.log(\"CANNOT READ\", e);\n      editor.setInfo({ sevarity: \"error\", text: t(\"common:info.loadFailed\") });\n    }\n  };\n\n  return (\n    <Box display=\"flex\" flexDirection=\"column\" gap={1}>\n      {worker !== undefined && templateImgs !== undefined ? (\n        <IconTextButton\n          text={t(\"editor.uploadScreenShot\")!}\n          icon={faCamera}\n          color={theme.palette.info.dark}\n        >\n          <input onChange={uploadImage} type=\"file\" accept=\"image/*\" hidden />\n          <canvas ref={dummyImgRef} style={{ display: \"none\" }} />\n        </IconTextButton>\n      ) : (\n        <CircularProgress />\n      )}\n      {/* <img\n        style={{ padding: 16, maxHeight: 256, objectFit: \"contain\" }}\n        src={imgSrc}\n      /> */}\n    </Box>\n  );\n};\nexport default AutoFillButton;\n"],"names":["imreadUrl","url","loadImage","e","cv","target","src","Promise","resolve","reject","i","Image","onload","onerror","imshowTrimmed","ref","scale","threshold","p1","p2","roi","Rect","x","y","size","width","height","Math","abs","current","ArtifactScan","left","right","mid","buf","worker","setProgress","ArtifactScanStr","strs","console","log","warning","error","lang","isAlphabet","slot","value","charAt","res","set","str2artifactSet","name","setKey","key","confidence","slotKey","push","rarity","max","min","star","replace","length","level","Number","mainstat","str2stat","mainKey","mainValue","mainStatKey","substats","str2stats","substat","forEach","stat","src_","performance","now","small","copyTo","resize","aspect","dst","mask","rightMatch","result","maxLoc","cols","leftMatch","all","rightright","leftleft","slimRect","slimImg","maxPoint","rows","midSeparator","topHalfR","trimmedImg","name1p","name2p","part1p","part2p","mainKey1p","mainKey2p","mainValue1p","mainValue2p","star1p","star2p","level1p","level2p","substat1p","substat2p","undefined","createWorker","loadLanguage","initialize","fname","recognize","toDataURL","data","text","fslot","fmainKey","fmainValue","fstar","flevel","setParameters","tessedit_char_whitelist","fsubstat","editor","useContext","EditorContext","dummyImgRef","useRef","useState","templateImgs","setTemplateImgs","setWorker","setImgSrc","t","useTranslation","loadTemplate","i1","i2","i3","initWorker","useEffect","templateImgs_","pasteFunc","pasteImage","clipboardData","files","window","addEventListener","removeEventListener","theme","useTheme","uploadImage","setArtifactFromImage","file","setInfo","sevarity","URL","createObjectURL","good","scanned","map","setArtifact","Box","display","flexDirection","gap","IconTextButton","icon","faCamera","color","palette","info","dark","onChange","type","accept","hidden","style","CircularProgress"],"sourceRoot":""}